<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Avatar Chat</title>
    <style>
      body {
        margin: 0;
        font-family: Arial, sans-serif;
        display: flex;
        align-items: center;
        justify-content: center;
        height: 100vh;
        background: url("img/chatbot bg.jpg") no-repeat center center;
        background-size: cover;
        color: #000000;
      }

      .chat-container {
        width: 90%;
        max-width: 800px;
        border-radius: 15px;
        box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
        overflow: hidden;
        display: flex;
        flex-direction: column;
      }

      .chat-box {
        position: relative;
        height: 500px;
        padding: 15px;
        overflow-y: auto;
        display: flex;
        flex-direction: column;
        color: #333;
      }

      .message {
        margin: 10px 0;
        padding: 10px 15px;
        border-radius: 10px;
        max-width: 70%;
        display: inline-block;
      }

      .user-message {
        align-self: flex-end;
        background: rgba(36, 150, 255, 0.8);
        color: white;
      }

      .bot-message {
        align-self: flex-start;
        background: rgba(108, 71, 230, 0.8);
        color: white;
        position: relative;
      }

      .icon-container {
        display: flex;
        margin-left: 20%;
        gap: 20px;
      }

      .icon {
        width: 24px;
        height: 24px;
        cursor: pointer;
        fill: white;
        transition: transform 0.2s, fill 0.2s;
      }

      .icon:hover {
        fill: #ffd700;
        transform: scale(1.2);
      }
      .bot-message .response-title {
  font-weight: bold;
  font-size: 1rem;
  margin-bottom: 5px;
}

.bot-message .response-points {
  margin: 0;
  padding-left: 15px;
}

.bot-message .response-points li {
  list-style-type: disc;
  margin: 5px 0;
}
.bot-message div {
  margin-bottom: 10px;
}

.bot-message ul {
  padding-left: 20px;
  list-style-type: disc;
}


      .input-container {
        display: flex;
        border-top: 1px solid rgba(0, 0, 0, 0.2);
        border-radius: 10px;
      }

      input[type="text"] {
        flex: 1;
        padding: 15px;
        font-size: 1rem;
        border: none;
        outline: none;
        border-radius: 10px;
      }

      button {
        padding: 15px 20px;
        background: linear-gradient(135deg, #2575fc, #6a11cb);
        border: none;
        color: white;
        font-size: 1rem;
        cursor: pointer;
        border-radius: 5px;
      }

      .speed-control {
        margin: 10px;
        text-align: center;
      }

      .speed-label {
        font-size: 0.9rem;
        margin-right: 10px;
      }

      .speed-slider {
        width: 50%;
      }
    </style>
  </head>
  <body>
    <div class="chat-container">
      <div class="chat-box" id="chat-box">
        <div class="message bot-message" id="bot-message-1">
          Hi! How can I assist you today?
        </div>
        <div class="icon-container">
          <!-- Mic Icon -->
          <svg
            class="icon"
            onclick="speakText('Hi! How can I assist you today?')"
            xmlns="http://www.w3.org/2000/svg"
            viewBox="0 0 24 24"
          >
            <path
              d="M12 14c1.66 0 3-1.34 3-3V5c0-1.66-1.34-3-3-3S9 3.34 9 5v6c0 1.66 1.34 3 3 3zm5-3c0 2.76-2.24 5-5 5s-5-2.24-5-5H5c0 3.87 3.13 7 7 7v4h-2v2h6v-2h-2v-4c3.87 0 7-3.13 7-7h-2z"
            />
          </svg>
          <!-- Copy Icon -->
          <svg
            class="icon"
            onclick="copyTextToClipboard('Hi! How can I assist you today?', this)"
            xmlns="http://www.w3.org/2000/svg"
            viewBox="0 0 24 24"
          >
            <path
              d="M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12V1zm3 4H8c-1.1 0-2 .9-2 2v16c0 1.1.9 2 2 2h11c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2zm0 18H8V7h11v16z"
            />
          </svg>
        </div>
      </div>
      <div class="input-container">
        <input type="text" id="user-input" placeholder="Type a message..." />
        <button id="send-btn">Send</button>
      </div>
      <div class="speed-control">
        <label class="speed-label" for="speed-slider">Speech Speed:</label>
        <input
          type="range"
          id="speed-slider"
          class="speed-slider"
          min="0.5"
          max="2"
          step="0.1"
          value="1"
        />
      </div>
    </div>

    <script>
function speakText(text) {
  if ("speechSynthesis" in window) {
    const utterance = new SpeechSynthesisUtterance(text);

    // Get speech speed from slider
    const speechSpeed = document.getElementById("speed-slider").value;
    utterance.rate = speechSpeed;

    speechSynthesis.speak(utterance);
  } else {
    console.error("Speech synthesis is not supported in this browser.");
  }
}

function copyTextToClipboard(text, copyIcon) {
  navigator.clipboard
    .writeText(text)
    .then(() => {
      const originalIcon = copyIcon.innerHTML; // Save the original icon
      copyIcon.innerHTML = `
        <path d="M9 16.17l-4.17-4.17-1.41 1.41L9 19 21 7l-1.41-1.41L9 16.17z" />`; // Tick icon
      setTimeout(() => {
        copyIcon.innerHTML = originalIcon; // Restore the original icon after 5 seconds
      }, 5000);
    })
    .catch((err) => console.error("Error copying text:", err));
}

document.getElementById("send-btn").addEventListener("click", sendMessage);

function sendMessage() {
  const userInput = document.getElementById("user-input").value.trim();
  if (userInput) {
    const chatBox = document.getElementById("chat-box");

    // User message
    const userMessage = document.createElement("div");
    userMessage.classList.add("message", "user-message");
    userMessage.textContent = userInput;
    chatBox.appendChild(userMessage);

    document.getElementById("user-input").value = "";

    // Fetch bot response
    fetch("http://localhost:5001/chat", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({ message: userInput }),
    })
      .then((response) => response.json())
      .then((data) => {
        let botResponse = data.response;

        // Remove all `*` symbols from the response
        botResponse = botResponse.replace(/\*/g, "");

        const botMessage = document.createElement("div");
        botMessage.classList.add("message", "bot-message");

        // Split the response into sections
        const sections = botResponse.split("\n\n");
        sections.forEach((section) => {
          if (section.trim()) {
            // Separate subheading and its content
            const [subheading, ...content] = section.split(":");

            // Add subheading in bold
            const subheadingDiv = document.createElement("div");
            subheadingDiv.style.fontWeight = "bold";
            subheadingDiv.style.marginBottom = "5px";
            subheadingDiv.textContent = subheading.trim();
            botMessage.appendChild(subheadingDiv);

            // Process content to bold any inline headings
            const contentDiv = document.createElement("div");
            const paragraphs = content.join(":").split("\n");
            paragraphs.forEach((paragraph) => {
              const boldHeadingRegex = /^(.*?):(.*)$/; // Matches headings like `Heading: Content`
              const match = boldHeadingRegex.exec(paragraph.trim());
              if (match) {
                const heading = document.createElement("span");
                heading.style.fontWeight = "bold";
                heading.textContent = `${match[1].trim()}: `;

                const bodyText = document.createElement("span");
                bodyText.textContent = match[2].trim();

                const paragraphDiv = document.createElement("div");
                paragraphDiv.appendChild(heading);
                paragraphDiv.appendChild(bodyText);
                contentDiv.appendChild(paragraphDiv);
              } else {
                const paragraphDiv = document.createElement("div");
                paragraphDiv.textContent = paragraph.trim();
                contentDiv.appendChild(paragraphDiv);
              }
            });

            botMessage.appendChild(contentDiv);
          }
        });

        chatBox.appendChild(botMessage);

        // Add icons (Mic and Copy) for each response
        const iconContainer = document.createElement("div");
        iconContainer.classList.add("icon-container");

        // Mic Icon
        const micIcon = document.createElementNS(
          "http://www.w3.org/2000/svg",
          "svg"
        );
        micIcon.setAttribute("class", "icon");
        micIcon.setAttribute("viewBox", "0 0 24 24");
        micIcon.innerHTML = `
          <path d="M12 14c1.66 0 3-1.34 3-3V5c0-1.66-1.34-3-3-3S9 3.34 9 5v6c0 1.66 1.34 3 3 3zm5-3c0 2.76-2.24 5-5 5s-5-2.24-5-5H5c0 3.87 3.13 7 7 7v4h-2v2h6v-2h-2v-4c3.87 0 7-3.13 7-7h-2z" />`;
        micIcon.onclick = () => speakText(botResponse);

        // Copy Icon
        const copyIcon = document.createElementNS(
          "http://www.w3.org/2000/svg",
          "svg"
        );
        copyIcon.setAttribute("class", "icon");
        copyIcon.setAttribute("viewBox", "0 0 24 24");
        copyIcon.innerHTML = `
          <path d="M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12V1zm3 4H8c-1.1 0-2 .9-2 2v16c0 1.1.9 2 2 2h11c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2zm0 18H8V7h11v16z" />`;
        copyIcon.onclick = () => copyTextToClipboard(botResponse, copyIcon);

        iconContainer.appendChild(micIcon);
        iconContainer.appendChild(copyIcon);

        chatBox.appendChild(iconContainer);
        chatBox.scrollTop = chatBox.scrollHeight;
      })
      .catch((error) => console.error("Error:", error));
  }
}


    </script>
  </body>
</html>
